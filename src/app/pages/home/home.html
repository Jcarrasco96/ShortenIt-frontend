<div class="container mt-2" @loaded>

  <div class="card shadow-sm mb-2">
    <div class="card-body">
      <form [formGroup]="shortenForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="url" class="form-label">Enter URL:</label>
          <input
            id="url"
            formControlName="url"
            type="url"
            class="form-control"
            placeholder="https://example.com"
            [class.is-invalid]="this.shortenForm.controls['url'].invalid && this.shortenForm.controls['url'].touched"
            required
          />
          @if (this.shortenForm.controls['url'].invalid && this.shortenForm.controls['url'].touched) {
            <div class="invalid-feedback">Please enter a valid URL.</div>
          }
        </div>

        <button type="submit" class="btn btn-primary" [disabled]="shortenForm.invalid || shortening">
          @if (shortening) {
            <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
            <span role="status">Shortening...</span>
          } @else {
            <i class="bi bi-scissors"></i> Shorten
          }
        </button>
      </form>
    </div>
  </div>

  <app-edit-link-modal #editModal (updated)="onLinkUpdated($event)"></app-edit-link-modal>

  <div class="card shadow-sm">
    <div class="card-body">
      @if (!loading) {
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
            <tr>
              <th>Original URL</th>
              <th>Short</th>
              <th>Access Count</th>
              <th>Options</th>
            </tr>
            </thead>
            <tbody>
              @for (link of links; track link.id) {
                <tr>
                  <td class="align-middle"><a [href]="link.original_url" target="_blank">{{ link.original_url }}</a></td>
                  <td class="align-middle"><a (click)="visitLink(link); $event.preventDefault();" href="link/{{ link.short_code }}">{{ link.short_code }}</a></td>
                  <td class="align-middle text-center">{{ link.access_count }}</td>
                  <td class="align-middle text-center">
                    <button class="d-none btn btn-primary btn-sm me-1" (click)="editModal.open(link)">
                      <i class="bi bi-pencil-fill"></i>
                    </button>

                    <button type="button" class="btn btn-danger btn-sm" (click)="delete(link.id)">
                      <i class="bi bi-trash-fill"></i>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <button type="button" class="btn btn-primary mt-2" [disabled]="loading" (click)="loadLinks()">
        @if (loading) {
          <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
          <span role="status">Refreshing...</span>
        } @else {
          <i class="bi bi-arrow-clockwise"></i> Refresh
        }
      </button>
    </div>
  </div>

</div>
