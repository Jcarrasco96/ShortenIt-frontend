<div @loaded>

  <app-create-link (onSubmitted)="onSubmitted()" class="d-print-none"></app-create-link>

  <div class="card shadow-sm">
    <div class="card-body">
      @if (!loading) {

        <div class="d-flex justify-content-between mb-3 d-print-none">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="params.search" (keyup.enter)="resetTable()" />
            <button class="btn btn-primary" (click)="resetTable()">Search</button>
          </div>
        </div>

        <div class="table-responsive mb-3">
          <table class="table table-hover table-bordered table-sm mb-0">
            <thead>
            <tr>
              @for (column of columns; track column.value) {
                <th scope="col" class="align-bottom" [class]="column.class">
                  <a href="#" (click)="sortBy(column.value); $event.preventDefault()">
                    {{ column.name }}
                    @if (sortColumn === column.value) {
                      @if (sortDirection === 'asc') {
                        <i class="bi bi-caret-up-fill"></i>
                      } @else {
                        <i class="bi bi-caret-down-fill"></i>
                      }
                    }
                  </a>
                </th>
              }
              <th class="align-bottom text-center d-print-none" style="width: 90px;">Options</th>
            </tr>
            </thead>
            <tbody>
              @for (link of links; track link.id;) {
                <tr>
                  <td class="align-middle"><a [href]="link.original_url" target="_blank">{{ link.original_url }}</a></td>
                  <td class="align-middle text-center"><a (click)="visitLink(link); $event.preventDefault();" href="link/{{ link.short_code }}">{{ link.short_code }}</a></td>
                  <td class="align-middle text-center">{{ link.access_count | number }}</td>
                  <td class="align-middle text-center">{{ link.created_at | date: 'short' }}</td>
                  <td class="align-middle text-center d-print-none">
                    <div class="btn-group">
                      <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-reference="parent" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">Actions</button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" type="button" (click)="openEditModal(link)"><i class="bi bi-pencil-fill"></i> Edit</button></li>
<!--                        <li><button class="dropdown-item" type="button" [disabled]="true"><i class="bi bi-copy"></i> Duplicate</button></li>-->
<!--                        <li><button class="dropdown-item" type="button" [disabled]="true"><i class="bi bi-scissors"></i> Move</button></li>-->
                        <li><div class="dropdown-divider"></div></li>
                        <li><button class="dropdown-item dropdown-item-delete" type="button" (click)="delete(link.id)"><i class="bi bi-trash-fill"></i> Delete</button></li>
                      </ul>
                    </div>

                  </td>
                </tr>
              } @empty {
                <tr>
                  <td class="align-middle" colspan="5">Empty list</td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <div class="d-flex align-items-center d-print-none">
          <ngb-pagination [collectionSize]="totalItems" [pageSize]="params.limit" [(page)]="params.page" [boundaryLinks]="true" (pageChange)="goToPage($event)" class="me-auto">
            <ng-template ngbPaginationPages let-page>
              @if (totalPages() > 0) {
                <li class="ngb-custom-pages-item">
                  <div class="d-flex flex-nowrap px-2">
                    <label id="paginationInputLabel" for="paginationInput" class="col-form-label me-2 ms-1">Page</label>
                    <input
                      #i
                      type="text"
                      inputmode="numeric"
                      pattern="[0-9]*"
                      class="form-control custom-pages-input"
                      id="paginationInput"
                      [value]="page"
                      (keyup.enter)="goToPage(i.value)"
                      (blur)="goToPage(i.value)"
                      (input)="formatInput($any($event).target)"
                      aria-labelledby="paginationInputLabel paginationDescription"
                      style="width: 2.5rem"
                    />
                    <span id="paginationDescription" class="col-form-label text-nowrap px-2"> of {{ totalPages() }}</span>
                  </div>
                </li>
              }
            </ng-template>
          </ngb-pagination>

          <select class="form-select mb-3" style="width: auto" name="pageSize" [(ngModel)]="params.limit" (change)="resetTable()">
            <option [ngValue]="10">10 items per page</option>
            <option [ngValue]="25">25 items per page</option>
            <option [ngValue]="50">50 items per page</option>
            <option [ngValue]="100">100 items per page</option>
            <option [ngValue]="250">250 items per page</option>
            <option [ngValue]="250">250 items per page</option>
          </select>

          <button type="button" class="btn btn-primary mb-3 ms-2" (click)="loadLinks()">
              <i class="bi bi-arrow-clockwise"></i>
          </button>

        </div>
      } @else {
        <h3 class="mb-0">
            <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
            <span role="status">Refreshing...</span>
        </h3>
      }

    </div>
  </div>

</div>
